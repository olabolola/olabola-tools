<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Link Extractor</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
            background: #f5f5f5;
        }

        h1 {
            color: #333;
            margin-bottom: 20px;
        }

        .upload-section {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .file-input-wrapper {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        input[type="file"] {
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 4px;
            flex: 1;
        }

        .status {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            display: none;
        }

        .status.loading {
            display: block;
            background: #e3f2fd;
            color: #1976d2;
        }

        .status.success {
            display: block;
            background: #e8f5e9;
            color: #388e3c;
        }

        .status.error {
            display: block;
            background: #ffebee;
            color: #c62828;
        }

        .results-section {
            display: none;
        }

        .results-section.visible {
            display: block;
        }

        .section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .section h2 {
            color: #333;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .copy-btn {
            background: #1976d2;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.2s;
        }

        .copy-btn:hover {
            background: #1565c0;
        }

        .copy-btn:active {
            background: #0d47a1;
        }

        .copy-btn.copied {
            background: #388e3c;
        }

        .links-container {
            background: #f9f9f9;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            padding: 15px;
            max-height: 400px;
            overflow-y: auto;
        }

        .link-item {
            padding: 8px 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .link-item:last-child {
            border-bottom: none;
        }

        .link-url {
            color: #1976d2;
            text-decoration: none;
            word-break: break-all;
        }

        .link-url:hover {
            text-decoration: underline;
        }

        .page-info {
            color: #666;
            font-size: 14px;
            margin-top: 4px;
        }

        .count-badge {
            background: #e0e0e0;
            color: #333;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: normal;
        }

        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: #666;
            font-size: 14px;
        }

        footer a {
            color: #1976d2;
            text-decoration: none;
        }

        footer a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <!-- ABOUTME: This tool extracts all links from PDF files and displays them in organized sections. -->
    <!-- ABOUTME: It shows unique links and all links with their page numbers, with copy-to-clipboard functionality. -->

    <h1>PDF Link Extractor</h1>

    <div class="upload-section">
        <div class="file-input-wrapper">
            <input type="file" id="pdfFile" accept=".pdf" />
        </div>
        <div id="status" class="status"></div>
    </div>

    <div id="results" class="results-section">
        <div class="section">
            <h2>
                Unique Links <span id="uniqueCount" class="count-badge">0</span>
                <button id="copyUnique" class="copy-btn">Copy to Clipboard</button>
            </h2>
            <div id="uniqueLinks" class="links-container"></div>
        </div>

        <div class="section">
            <h2>
                All Links with Page Numbers <span id="allCount" class="count-badge">0</span>
                <button id="copyAll" class="copy-btn">Copy to Clipboard</button>
            </h2>
            <div id="allLinks" class="links-container"></div>
        </div>
    </div>

    <footer>
        Built with <a href="https://mozilla.github.io/pdf.js/" target="_blank">PDF.js</a>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>
        // Configure PDF.js worker
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        const fileInput = document.getElementById('pdfFile');
        const status = document.getElementById('status');
        const results = document.getElementById('results');
        const uniqueLinksDiv = document.getElementById('uniqueLinks');
        const allLinksDiv = document.getElementById('allLinks');
        const uniqueCountBadge = document.getElementById('uniqueCount');
        const allCountBadge = document.getElementById('allCount');
        const copyUniqueBtn = document.getElementById('copyUnique');
        const copyAllBtn = document.getElementById('copyAll');

        let extractedData = {
            uniqueLinks: [],
            allLinks: []
        };

        fileInput.addEventListener('change', handleFileSelect);
        copyUniqueBtn.addEventListener('click', () => copyToClipboard('unique'));
        copyAllBtn.addEventListener('click', () => copyToClipboard('all'));

        async function handleFileSelect(event) {
            const file = event.target.files[0];
            if (!file) return;

            showStatus('loading', 'Processing PDF...');
            results.classList.remove('visible');

            try {
                const links = await extractLinksFromPDF(file);
                displayResults(links);
                showStatus('success', `Found ${links.allLinks.length} total links (${links.uniqueLinks.size} unique)`);
                results.classList.add('visible');
            } catch (error) {
                showStatus('error', `Error: ${error.message}`);
                console.error(error);
            }
        }

        async function extractLinksFromPDF(file) {
            const arrayBuffer = await file.arrayBuffer();
            const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;

            const allLinks = [];
            const uniqueLinksSet = new Set();
            const linkToPages = new Map();

            for (let pageNum = 1; pageNum <= pdf.numPages; pageNum++) {
                const page = await pdf.getPage(pageNum);
                const annotations = await page.getAnnotations();

                for (const annotation of annotations) {
                    let url = null;

                    if (annotation.subtype === 'Link') {
                        // Check multiple possible sources for the URL
                        if (annotation.url) {
                            url = annotation.url;
                        } else if (annotation.unsafeUrl) {
                            url = annotation.unsafeUrl;
                        } else if (annotation.action) {
                            if (annotation.action.url) {
                                url = annotation.action.url;
                            } else if (annotation.action.unsafeUrl) {
                                url = annotation.action.unsafeUrl;
                            }
                        } else if (annotation.contents) {
                            // Sometimes the URL is in the contents field
                            const contents = annotation.contents;
                            if (contents && (contents.includes('://') || contents.startsWith('notes:'))) {
                                url = contents;
                            }
                        }

                        // Skip internal PDF destinations
                        if (!url && annotation.dest) {
                            continue;
                        }
                    }

                    if (url) {
                        allLinks.push({ url, page: pageNum });
                        uniqueLinksSet.add(url);

                        if (!linkToPages.has(url)) {
                            linkToPages.set(url, []);
                        }
                        linkToPages.get(url).push(pageNum);
                    }
                }
            }

            return {
                uniqueLinks: uniqueLinksSet,
                allLinks: allLinks,
                linkToPages: linkToPages
            };
        }

        function displayResults(links) {
            extractedData = links;

            // Display unique links
            uniqueLinksDiv.innerHTML = '';
            uniqueCountBadge.textContent = links.uniqueLinks.size;

            if (links.uniqueLinks.size === 0) {
                uniqueLinksDiv.innerHTML = '<div class="link-item">No links found in this PDF</div>';
            } else {
                const sortedUniqueLinks = Array.from(links.uniqueLinks).sort();
                sortedUniqueLinks.forEach(url => {
                    const div = document.createElement('div');
                    div.className = 'link-item';
                    const a = document.createElement('a');
                    a.href = url;
                    a.target = '_blank';
                    a.className = 'link-url';
                    a.textContent = url;
                    div.appendChild(a);
                    uniqueLinksDiv.appendChild(div);
                });
            }

            // Display all links with page numbers
            allLinksDiv.innerHTML = '';
            allCountBadge.textContent = links.allLinks.length;

            if (links.allLinks.length === 0) {
                allLinksDiv.innerHTML = '<div class="link-item">No links found in this PDF</div>';
            } else {
                // Group by URL for display
                const linksByUrl = new Map();
                links.allLinks.forEach(({ url, page }) => {
                    if (!linksByUrl.has(url)) {
                        linksByUrl.set(url, []);
                    }
                    linksByUrl.get(url).push(page);
                });

                // Sort by first appearance
                const sortedLinks = Array.from(linksByUrl.entries()).sort((a, b) => {
                    return Math.min(...a[1]) - Math.min(...b[1]);
                });

                sortedLinks.forEach(([url, pages]) => {
                    const div = document.createElement('div');
                    div.className = 'link-item';

                    const a = document.createElement('a');
                    a.href = url;
                    a.target = '_blank';
                    a.className = 'link-url';
                    a.textContent = url;
                    div.appendChild(a);

                    const pageInfo = document.createElement('div');
                    pageInfo.className = 'page-info';
                    const uniquePages = [...new Set(pages)].sort((a, b) => a - b);
                    pageInfo.textContent = `Page${uniquePages.length > 1 ? 's' : ''}: ${uniquePages.join(', ')}`;
                    div.appendChild(pageInfo);

                    allLinksDiv.appendChild(div);
                });
            }
        }

        function copyToClipboard(type) {
            let text = '';
            const button = type === 'unique' ? copyUniqueBtn : copyAllBtn;

            if (type === 'unique') {
                const sortedLinks = Array.from(extractedData.uniqueLinks).sort();
                text = sortedLinks.join('\n');
            } else {
                // All links with page numbers
                const linksByUrl = new Map();
                extractedData.allLinks.forEach(({ url, page }) => {
                    if (!linksByUrl.has(url)) {
                        linksByUrl.set(url, []);
                    }
                    linksByUrl.get(url).push(page);
                });

                const sortedLinks = Array.from(linksByUrl.entries()).sort((a, b) => {
                    return Math.min(...a[1]) - Math.min(...b[1]);
                });

                const lines = sortedLinks.map(([url, pages]) => {
                    const uniquePages = [...new Set(pages)].sort((a, b) => a - b);
                    return `${url} (Page${uniquePages.length > 1 ? 's' : ''}: ${uniquePages.join(', ')})`;
                });

                text = lines.join('\n');
            }

            navigator.clipboard.writeText(text).then(() => {
                const originalText = button.textContent;
                button.textContent = 'Copied!';
                button.classList.add('copied');

                setTimeout(() => {
                    button.textContent = originalText;
                    button.classList.remove('copied');
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy:', err);
                alert('Failed to copy to clipboard');
            });
        }

        function showStatus(type, message) {
            status.className = `status ${type}`;
            status.textContent = message;
        }
    </script>
</body>
</html>
